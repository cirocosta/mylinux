---
# Provisions an already-running AWS machine
# by SSHing into it and performing the necessary
# mutations.
#
# Using `hosts: aws-ami` we let Packer properly
# set the variables needed for the host connection
# so we don't need to care about that.

- hosts: 'aws-ami'
  any_errors_fatal: true
  become: true
  gather_facts: false
  roles:
    - 'bootstrap'

- hosts: 'aws-ami'
  become: true
  any_errors_fatal: true
  vars:
    bcc_apt_repository_distribution_release: 'artful'
    docker_apt_repository_distribution_release: 'artful'
    docker_enable_service: 'no'
  roles:
    - 'base'
    - 'clang'
    - 'go'
    - 'vim'
    - 'docker'
    - 'bcc'
    - 'bpftrace'
